# TODO: cache to skip computing subtrees only on head tag change
